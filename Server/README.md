### Coop Management Software: BBD9000-CMS:
##### Hosted software that communicates with kiosks, coop/fleet members and administrators using HTML/HTTP.
* Maintains per-member account, balance, sales and contact information
* Administrative pages to keep track of inventory levels at kiosks, consolidated sales, etc.
* Member pages to update contact info, track purchases, add family members, credit-cards, etc.
* Credit Card Gateway communications for financial transactions (currently Authorize.net Card Present protocol)
* Implemented using Perl/MySQL
* Deployment using  [lighttpd] (http://www.lighttpd.net/)
* Perl source in `BBD9000/Server/web/fcgi-bin/`
  * Package for common tasks in `BBD.pm`
  * Perl script per web-page in `BBD-*.pl`
    * Perl Templates in `BBD9000/Server/tmpl/`
    * Setup scripts and other help in `BBD9000/Server/web/setup/`
      * These are meant to be read and commands executed manually for now depending on OS setup!
      * Please assume that these will completely and irreversibly buggeer your OS if blindly executed!!!

##### A missing directory (`priv/`) is required for deployment at the same level as the `web/`, `tmpl/` and `bin/` directories.
* **This directory contains sensitive private files and must be inacessible from the web server**
* `DB_CONF.cnf`: Database access credentials for server scripts. A file in the following format:

        # DB_CONF.cnf
        
        [client]
        host     = localhost
        database = bbd_members
        user     = bbd-server
        password = xxxxxxxx

   This file is generated by the `setup/03-Ubuntu12-Setup-MySQL.sh` script.  Be sure to modify
   the site-specific variables in `setup/coop_defs.sh` before running any of the setup scripts!


* `BBD.pem`: Server's **private** key for kiosk communications
  * generate new 1024-bit private and public RSA keys for the server using the openssl CLI tools:

          openssl genrsa -F4 -out BBD.pem 1024
          openssl rsa -in BBD.pem -out BBD-pub.pem -pubout
          chmod 400 BBD.pem
          chmod a-w BBD-pub.pem

  * Use openssl CLI tools to generate new 1024-bit private and public RSA keys for each kiosk:

          openssl genrsa -F4 -out BBD9000-0001.pem 1024
          openssl rsa -in BBD9000-0001.pem -out BBD9000-0001-pub.pem -pubout
          chmod 400 BBD9000-0001.pem
          chmod a-w BBD9000-0001-pub.pem

  * Each kiosk gets the server's **public** key (`BBD-pub.pem`), and its own **private** key (`BBD9000-0001.pem`).
  * The server gets its own **private** key (`BBD.pem`) and each kiosk's **public** key (`BBD9000-0001-pub.pem`).
* `BBDC_GW.conf`: The credit-card gateway credentials, containing one uncommented line in the following format:
 
        CC_URL x_cpversion x_login x_market_type x_device_type x_tran_key
   e.g.:

        # These are the authorize.net transaction credentials
        # The order of the space-separated fields is:
        # CC_URL x_cpversion x_login x_market_type x_device_type x_tran_key
        https://cardpresent.authorize.net/gateway/transact.dll 1.0 xxxxxxxxxx 2 3 xxxxxxxxxx

##### Webserver configuration using lighthttpd:

* Once the credential directory (`priv/`) is setup, run the script in `setup/06-Ubuntu12-lighttpd-virtual.sh` to set up a virtual server for the coop domain

